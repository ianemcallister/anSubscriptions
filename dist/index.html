<html lang='en' ng-app='ansub'>
<head>
	<meta charset="UTF-8">
	
	<!--CDNs-->
	<!--Bootstrap-->
	<!--Old One <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />-->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

	<!--Scripts-->
	<script   src="https://code.jquery.com/jquery-3.3.1.min.js"   integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="   crossorigin="anonymous"></script>
	
	<!--Angular-->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.0/ui-bootstrap-tpls.js"></script>

	<!--Setting up Angular-->
	<script>
		var ahNuts = angular.module('ansub', ['ui.bootstrap']);

	</script>
		
	<!--Flavors Modal-->
	<script>
	angular.module('ansub').service('modalService', modalService);

	/* @ngInject */
	modalService.$inject = ['$uibModal'];

	/* @ngInject */
	function modalService($uibModal) {
		//define local variables
		var modalDefaults = {
            backdrop: true,
            keyboard: true,
            modalFade: true,
            templateUrl: 'partials/modal.htm'
        };

        var modalOptions = {
            closeButtonText: 'Close',
            actionButtonText: 'OK',
            headerText: 'Proceed?',
            bodyText: 'Perform this action?'
        };

        this.showModal = function (customModalDefaults, customModalOptions) {
            if (!customModalDefaults) customModalDefaults = {};
            customModalDefaults.backdrop = 'static';
            return this.show(customModalDefaults, customModalOptions);
        };

        this.show = function (customModalDefaults, customModalOptions) {
            //Create temp objects to work with since we're in a singleton service
            var tempModalDefaults = {};
            var tempModalOptions = {};

            //Map angular-ui modal custom defaults to modal defaults defined in service
            angular.extend(tempModalDefaults, modalDefaults, customModalDefaults);

            //Map modal.html $scope custom properties to defaults defined in service
            angular.extend(tempModalOptions, modalOptions, customModalOptions);

            if (!tempModalDefaults.controller) {
                tempModalDefaults.controller = function ($scope, $modalInstance) {
                    $scope.modalOptions = tempModalOptions;
                    $scope.modalOptions.ok = function (result) {
                        $modalInstance.close(result);
                    };
                    $scope.modalOptions.close = function (result) {
                        $modalInstance.dismiss('cancel');
                    };
                }
            }

            return $modal.open(tempModalDefaults).result;
        };
		
	};	

	</script>

	<!--Main Controller-->
	<script>
	angular.module('ansub').controller('mainController', mainController);

	mainController.$inject = ['$scope','$log', 'modalService'];

	/* @ngInject */
	function mainController($scope, $log, modalService) {
		//define local variables
		var recipiantProfile = {
			name: {
				first: "",
				last: ""
			},
			address: {
				street1: "",
				street2: "",
				street3: "",
				city: "",
				state: "",
				zip: ""
			},
			contact: {},
			relationship: ""
		};

		var shippingSchedules = {
			"yearly": [
				{ id: 1, name: "Treat", shipDay: "", billDay: "" }
			],
			"quarterly": [
				{ id: 1, name: "Winter", shipDay: "", billDay: "" },
				{ id: 2, name: "Spring", shipDay: "", billDay: "" },
				{ id: 3, name: "Summer", shipDay: "", billDay: "" },
				{ id: 4, name: "Fall", shipDay: "", billDay: "" }
			],
			"monthly": [
				{ id: 1, name: "January", shipDay: "3rd", billDay: "1st" },
				{ id: 2, name: "February", shipDay: "3rd", billDay: "1st" },
				{ id: 3, name: "March", shipDay: "3rd", billDay: "1st" },
				{ id: 4, name: "April", shipDay: "3rd", billDay: "1st" },
				{ id: 5, name: "May", shipDay: "3rd", billDay: "1st" },
				{ id: 6, name: "June", shipDay: "3rd", billDay: "1st" },
				{ id: 7, name: "July", shipDay: "3rd", billDay: "1st" },
				{ id: 8, name: "August", shipDay: "3rd", billDay: "1st" },
				{ id: 9, name: "September", shipDay: "3rd", billDay: "1st" },
				{ id: 10, name: "October", shipDay: "3rd", billDay: "1st" },
				{ id: 11, name: "November", shipDay: "3rd", billDay: "1st" },
				{ id: 12, name: "December", shipDay: "3rd", billDay: "1st" }
			],
			"weekly": weeklyGenerator()

		}
		
		var shippingOccurance = {
			id: 0,
			name: "",
			date: ""
		};

		function weeklyGenerator() {
			//define local variables
			var allWeeks = [];

			for(var i = 1; i <= 52; i++) {
				var weekName = "Week " + i;
				allWeeks.push({ id: i, name: weekName, shipDay: "Tuesday", billDay: "Friday" });
			};

			return allWeeks;
		};

		//define flavor variables
		$scope.flavors= [
			{ name: 'Secret Recipe Pecans', description: " " },
			{ name: 'Secret Recipe Almonds', description: " " },
			{ name: 'Secret Recipe Cashews', description: " " },
			{ name: 'Secret Recipe Peanuts', description: " " },
			{ name: 'Cinnamon Pecans', description: " " },
			{ name: 'Cinnamon Almonds', description: " " },
			{ name: 'Drunken Pecans', description: " " },
			{ name: 'Mix-It-Up', description: " " }
		];

		$scope.orderSchedule = [
			{ id: 1 }
		];

		//define userdata model variable
		$scope.userData = {
			name: {
				first: "",
				last: ""
			},
			contact: {
				email: "",
				phone: ""
			},
			shippingDestinations: [],
			shippingSchedule: shippingSchedules.monthly,
			recipiantList: [ { relationship:"Myself"} ],
			subType: "myself"
		};

		//define state variables
		$scope.state = {
			tempRecipiant: {
				name: {
					first: "",
					last: ""
				},
				address: {
					street1: "",
					street2: "",
					street3: "",
					city: "",
					state: "",
					zip: ""
				},
				contact: {
					email: "",
					phone: ""
				},
				relationship: ""
			},
			order: {
				qty: "1",
				visibility: {
					one: true,
					two: false,
					three: false,
					four: false,
				}
			},
			frequency: {
				value: 'monthly'
			},
			shippingDestinations: "1",
			recipientsBox: "1",
			recipiantSelected: {
				state: false,
				id: ""
			},
			subType: {},
			selectedRecipiant: 0
		}

		//local functions
		function addToRecipiantList(relationship) {
			
			//define local variables
			var newRecipiant = Object.create(recipiantProfile);
			var existsAlready = false;
			var entryIndex = 0;
			var i = 0;

			//1. check for the relationship
			$scope.userData.recipiantList.forEach(function(recipiant) {
				if(recipiant.relationship == relationship) {
					existsAlready = true;
					entryIndex = i;
				};
				i++;
			});

			//console.log('adding', relationship, 'to recipiant list', $scope.userData.recipiantList, "already Exists?", existsAlready);

			//if relationship doesn't exist yet, add it
			if(!existsAlready) {
				newRecipiant.relationship = relationship;
				$scope.userData.recipiantList.push(newRecipiant);
			}
			
			//return result
			return entryIndex;
		};

		function removeFromRecipiantList(relationship) {
			
			//console.log('removing', relationship, 'to recipiant list');

			//define local variabls
			var i = 0;

			//iterate through array
			$scope.userData.recipiantList.forEach(function(recipiant) {
				if(recipiant.relationship == relationship) {
					$scope.userData.recipiantList.splice(i, 1);
				}
				i++;
			});

			//return result
			return 0;
		};

		function selectRecipiant(index) {

			$scope.state.selectedRecipiant = index;
		};

		//view model functions
		//UPDATE ORDER VISIBILITY
		$scope.updateOrderVisiblity = function(value) {
			//define local variales
			var hash = {"one": 1, "two": 2, "three": 3, "four": 4};
				
			//iterate through values
			Object.keys($scope.state.order.visibility).forEach(function(key) {
				if(hash[key] <= value) $scope.state.order.visibility[key] = true
					else $scope.state.order.visibility[key] = false
			});

			//console.log('checking values', value, $scope.state.order.visibility);
			
		};

		//UPDATE FREQUENCY
		$scope.updateFrequency = function(value) {
			$scope.userData.shippingSchedule = shippingSchedules[value];
		};

		//UPDATE ORDER SCHEDULE
		$scope.updateOrderSchedule = function(value) {
			//define local variables
		}

		//UPDATE THE SUBSCRIPTION TYPE
		$scope.updateSubType = function(value) {
			//define local variables
			var updateIndex = 0;
			$scope.userData.subType = value;

			if(value=="myself") {
				//$scope.state.recipientsBox = "10";
				addToRecipiantList("Myself");
				removeFromRecipiantList("Someone");
				selectRecipiant(0);
			} else if(value=="others") {
				//$scope.state.recipientsBox = "10";
				updateIndex = addToRecipiantList("Someone");
				removeFromRecipiantList("Myself");
				selectRecipiant(0);
			} else if(value=="both") {
				//$scope.state.recipientsBox = "10";
				updateIndex = addToRecipiantList("Myself");
				addToRecipiantList("Someone");
				selectRecipiant(0);
			}
		};

		$scope.selectRecipiant = function(index) {
			selectRecipiant(index);
			$scope.state.tempRecipiant = $scope.userData.recipiantList[index];
		};

		$scope.updateRecipiantValues = function() {
			var index = $scope.state.selectedRecipiant;
			$scope.userData.recipiantList[index] = $scope.state.tempRecipiant;
		};
		
	};
	</script>

	<!--Shipping Destination Directive-->
	<script>
	angular.module('ansub').directive('shipDest', shipDest);

	/* @ngInject */
	function shipDest() {
		//define the directive
		var directive = {
			restrict: "AECM",
			template: '<div>testing</div>',
			replace: true,
			scope: {},
			link: linkFunc,
			controller: shipDestController,
			controllerAs: 'vm',
			bindToController: true
		};

		/* @ngInject */
		function linkFunc(scope, el, attr, ctrl) {}
		
		shipDestController.$inject = ['$scope', '$log'];

		/* @ngInject */
		function shipDestController($scope, $log) {
			//define local variables
			var self = this;

			console.log('in shipDestController');

		}

		return directive;
	}
	</script>

	<!--Product Selection Directive-->
	<script>
	angular.module('ansub').directive('productSelection', productSelection);

	/* @ngInject */
	function productSelection() {
		//define the directive
		var directive = {
			restrict: "AECM",
			templateUrl: 'views/productSelection.htm',
			replace: true,
			scope: {},
			link: linkFunc,
			controller: productSelectionController,
			controllerAs: 'vm',
			bindToController: true
		};

		/* @ngInject */
		function linkFunc(scope, el, attr, ctrl) {}
		
		productSelectionController.$inject = ['$scope', '$log'];

		/* @ngInject */
		function productSelectionController($scope, $log) {
			//define local variables
			var self = this;
			var productObject = { 
				id: 1, 
				flavor: '', 
				mixflvrs: {
					srpec: false,
					sralm: false,
					srcsh: false,
					srpea: false,
					cnpec: false,
					cnalm: false,
					drpec: false
				} 
			};

			//define view model variables
			self.state = {
				addAProductBtn: {
					classes: {
						'btn': true,
						'btn-success': true,
						'btn-warning': false
					},
					visible: true
				},
				removeLastProductBtn: {
					classes: {
						'btn': true,
						'btn-success': false,
						'btn-warning': false,
						'btn-danger': true
					},
					visible: false
				},
				headerStyle: {
					color: "rgb(51,51,51)"
				},
				flavorsVisible: false,
				sectionComplete: false
			};

			self.flavors= [
				{ name: 'Secret Recipe Pecans', description: "Sweet and Salty" },
				{ name: 'Secret Recipe Almonds', description: "Sweet and Salty" },
				{ name: 'Secret Recipe Cashews', description: "Sweet and Salty" },
				{ name: 'Secret Recipe Peanuts', description: "Sweet and Salty" },
				{ name: 'Cinnamon Pecans', description: "Bavarian" },
				{ name: 'Cinnamon Almonds', description: "Bavarian" },
				{ name: 'Drunken Pecans', description: "Savory" },
				{ name: 'Mix-It-Up', description: "Whatever You Like" }
			];

			self.orderList = [];

			self.productPrice = 17;

			self.order = {
				discounts: 0,
				shipping: 0,
				total: 0
			}

			//console.log('in productSelectionController');

			//define local functions
			function sumOrder() {

				self.order.total = (self.orderList.length * self.productPrice) - self.order.discounts;
				if(self.orderList.length == 4) self.order.total = self.order.total - self.productPrice;
			};

			//define view model functions
			//ADD A PRODUCT BUTTON
			self.addAProduct = function() {
				//define local variabels
				var noOfProducts = self.orderList.length;

				//if there is room add another product
				if(noOfProducts < 4) self.orderList.push(Object.create(productObject));

				//if this is the last available slot hide the add button
				if(noOfProducts == 3) self.state.addAProductBtn.visible = false;

				//if there is more than one product add the remove button
				if(noOfProducts > 0) self.state.removeLastProductBtn.visible = true;

				//make sure the id's are correct
				for(var i = 0; i <= noOfProducts; i++) {
					self.orderList[i].id = i + 1
				}

				//calculate money
				//if(noOfProducts == 3) self.order.discounts = self.productPrice;

				sumOrder();
				//console.log('adding a product');
			};

			//REMOVE LAST PRODUCT BUTTON
			self.removeLastProduct = function() {
				//define local variables
				var noOfProducts = self.orderList.length;
				var removeIndex = noOfProducts - 1;

				//if there are at least two products, remove one
				if(noOfProducts > 1) self.orderList.splice(removeIndex, 1);

				//if down to one item, hide the remove button
				if(noOfProducts == 2) self.state.removeLastProductBtn.visible = false;

				//bring the add button back
				self.state.addAProductBtn.visible = true;

				//calculate money
				if(noOfProducts == 4) self.order.discounts = 0;

				sumOrder();

				//console.log('removing product', noOfProducts);
			};

			//REMOVE A PRODUCT BUTTON
			self.removeAProduct = function(id) {
				//define local variables
				var noOfProducts = self.orderList.length;
				var removeIndex = id - 1;

				//if there are at least two products, remove one
				if(noOfProducts > 1) self.orderList.splice(removeIndex, 1);

				//make sure the id's are correct
				for(var i = 0; i <= (self.orderList.length - 1); i++) {
					self.orderList[i].id = i + 1
				}

				sumOrder();
			}

			//VALIDATE THE PRODUCTS WHEN CHANGED
			self.validateProducts = function() {
				var valid = false;
				//console.log("validateing products");

				if(valid) self.state.headerStyle.color = "rgb(0,165,128)"
			}

			//start this by adding a product to the order list
			self.orderList.push(Object.create(productObject));

			sumOrder();
		};

		return directive;		
	};
	</script>
	
	<!--Frequency Selection Directive-->
	<script>
	angular.module('ansub').directive('frequencySelection', frequencySelection);

	/* @ngInject */
	function frequencySelection() {
		//define the directive
		var directive = {
			restrict: "AECM",
			templateUrl: 'views/frequencySelection.htm',
			replace: true,
			scope: {},
			link: linkFunc,
			controller: frequencySelectionController,
			controllerAs: 'vm',
			bindToController: true
		};

		/* @ngInject */
		function linkFunc(scope, el, attr, ctrl) {}
		
		frequencySelectionController.$inject = ['$scope', '$log'];

		/* @ngInject */
		function frequencySelectionController($scope, $log) {
			//define local variables
			var self = this;

			//define view model variables
			self.frequencies = [
				"month",
				"quarter",
				"year"
			];

			self.starts = {
				month: ["January", "February", "March", "April", "May", "June","July","August","September","October","November","December"],
				quarter: ["Winter", "Spring", "Summer", "Fall"],
				year: ["2018", "2019", "2020"]
			}

			self.selectedFrequency = '';
			self.startsIn = '';

			console.log('in frequencySelectionController');

		};

		return directive;		
	};
	</script>

	<!--Address Input Directive-->
	<script>
	angular.module('ansub').directive('singleAddressInput', singleAddressInput);

	/* @ngInject */
	function singleAddressInput() {
		//define the directive
		var directive = {
			restrict: "AECM",
			templateUrl: 'views/singleAddressInput.htm',
			replace: true,
			scope: {},
			link: linkFunc,
			controller: singleAddressInputController,
			controllerAs: 'vm',
			bindToController: true
		};

		/* @ngInject */
		function linkFunc(scope, el, attr, ctrl) {}
		
		singleAddressInputController.$inject = ['$scope', '$log'];

		/* @ngInject */
		function singleAddressInputController($scope, $log) {
			//define local variables
			var self = this;

			console.log('in singleAddressInputController');

		};

		return directive;		
	};
	</script>

	<!--Contact Directive-->
	<script>
	angular.module('ansub').directive('contactInput', contactInput);

	/* @ngInject */
	function contactInput() {
		//define the directive
		var directive = {
			restrict: "AECM",
			templateUrl: 'views/contactInput.htm',
			replace: true,
			scope: {},
			link: linkFunc,
			controller: contactInputtController,
			controllerAs: 'vm',
			bindToController: true
		};

		/* @ngInject */
		function linkFunc(scope, el, attr, ctrl) {}
		
		contactInputtController.$inject = ['$scope', '$log'];

		/* @ngInject */
		function contactInputtController($scope, $log) {
			//define local variables
			var self = this;

			console.log('in contactInputtController');

		};

		return directive;		
	};
	</script>


</head>
<body>
<div class="container" ng-controller="mainController">
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 form-group">

<!--Selecting the subscription type-->
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<!--Make My Life Easy-->
	<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
		
	</div>	
	<!--Make Me Look Good-->
	<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
	</div>
</div>	
</div>

<!--Product Selection-->
<product-selection>
</product-selection>

<!--Frequency Selection-->
<!--<frequency-selection>
</frequency-selection>-->

<!--Address Input-->
<single-address-input>
</single-address-input>

<!--Contact Submitt-->
<contact-input>
</contact-input>

<!--Submission-->
<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<h4>4. Submit</h4>
	<p>You’re almost there!  Click the submit button and your subscription order will be set up in our system.</p>
	<p>A secure invoice link will be emailed to you soon (from Square).  Please fill in the payment information and authorize Square to store your payment information for monthly payment.</p>
	<p>Your order will be charged on the 27th of each month (on the 25th of February) and your subscription order will be shipped by the 3rd of each month.</p>
	
	<p class='form-check'><input type="checkbox" class='form-check-input'> I agree to the Ah-Nuts terms and conditions.</p>
	<br>

	<button class="btn btn-success btn-block">Submit</button>
	
	<br><br><br>
	</div>
</div>

</div>
</div>


</body>
</html>