var ahNuts=angular.module("ansub",["ngRoute","ui.bootstrap"]);
function mainController(e,o,n,t,i,r,a){e.userData=i,e.state=r,e.$on("$viewContentLoaded",function(){console.log("$viewContentLoaded"),a.init()})}ahNuts.controller("mainController",mainController),mainController.$inject=["$scope","$log","$location","submissionService","userDataService","stateService","squareService"];
function successController(o,c,e){o.confirmationCode=e.confirmationCode,console.log("success controler",e.confirmationCode,o.confirmationCode)}angular.module("ansub").controller("successController",successController),successController.$inject=["$scope","$log","$routeParams"];
function billingAddress(){t.$inject=["scope","el","attr","ctrl"];var e={restrict:"AECM",templateUrl:"views/billingAddress.htm",replace:!0,scope:{},link:t,controller:r,controllerAs:"vm",bindToController:!0};function t(e,t,r,i){}function r(e,t,r,i){this.userData=r,this.state=i}return r.$inject=["$scope","$log","userDataService","stateService"],e}ahNuts.directive("billingAddress",billingAddress);
function billingInput(){e.$inject=["scope","el","attr","ctrl"];var t={restrict:"AECM",templateUrl:"views/billingInput.htm",replace:!0,scope:{},link:e,controller:n,controllerAs:"vm",bindToController:!0};function e(t,e,n,i){}function n(t,e,n,i){this.userData=n,this.state=i,t.$on("$viewContentLoaded",function(){console.log("$viewContentLoaded")})}return n.$inject=["$scope","$log","userDataService","stateService"],t}ahNuts.directive("billingInput",billingInput);
function contactInput(){n.$inject=["scope","el","attr","ctrl"];var t={restrict:"AECM",templateUrl:"views/contactInput.htm",replace:!0,scope:{},link:n,controller:c,controllerAs:"vm",bindToController:!0};function n(t,n,c,e){}function c(t,n,c,e,a){var i=this;i.userData=c,i.state=e,i.validate=function(t,n){console.log("got these",t,n);var c=a.contact[t](n);i.state.contactInput[t].input["is-invalid"]=c?!(i.state.contactInput[t].input["is-valid"]=!0):!(i.state.contactInput[t].input["is-valid"]=!1)}}return c.$inject=["$scope","$log","userDataService","stateService","validationService"],t}ahNuts.directive("contactInput",contactInput);
function frequencySelection(){r.$inject=["scope","el","attr","ctrl"];var e={restrict:"AECM",templateUrl:"views/frequencySelection.htm",replace:!0,scope:{},link:r,controller:t,controllerAs:"vm",bindToController:!0};function r(e,r,t,n){}function t(e,r){var t=this;t.frequencies=["month","quarter","year"],t.starts={month:["January","February","March","April","May","June","July","August","September","October","November","December"],quarter:["Winter","Spring","Summer","Fall"],year:["2018","2019","2020"]},t.selectedFrequency="",t.startsIn=""}return t.$inject=["$scope","$log"],e}angular.module("ansub").directive("frequencySelection",frequencySelection);
function productSelection(){t.$inject=["scope","el","attr","ctrl"];var e={restrict:"AECM",templateUrl:"views/productSelection.htm",replace:!0,scope:{},link:t,controller:r,controllerAs:"vm",bindToController:!0};function t(e,t,r,o){}function r(r,e,t,o,s,i){var a=this;a.userData=t,a.state=o.productSelection,a.state.infoBox=o.infoBoxes.flavorDefs,console.log("self.userData.promoCode",a.userData.promoCode),s.download.productList().then(function(e){a.flavors=e,r.$apply()}).catch(function(e){console.log("product list error, ",e)}),a.orderList=t.order,a.productPrice=1699,a.order=t.tender;var d={id:1,sqrId:"",sqVarId:"",flavor:"",mixflvrCount:0,mixflvrs:{swpec:{id:"swpec",name:"Sweet & Salty Pecans",selected:!1,classes:{"list-group-item":!0,active:!1}},drpec:{id:"drpec",name:"Drunk Pecans",selected:!1,classes:{"list-group-item":!0,active:!1}},swalm:{id:"swalm",name:"Sweet & Salty Almonds",selected:!1,classes:{"list-group-item":!0,active:!1}},dralm:{id:"dralm",name:"Drunk Almonds",selected:!1,classes:{"list-group-item":!0,active:!1}},swhzl:{id:"swhzl",name:"Sweet & Salty Hazelnuts",selected:!1,classes:{"list-group-item":!0,active:!1}},drhzl:{id:"drhzl",name:"Drunk Hazelnuts",selected:!1,classes:{"list-group-item":!0,active:!1}},swcsh:{id:"swcsh",name:"Sweet & Salty Cashews",selected:!1,classes:{"list-group-item":!0,active:!1}},swpea:{id:"swpea",name:"Sweet & Salty Peanuts",selected:!1,classes:{"list-group-item":!0,active:!1}}},mixFlvrsSelected:[],mix:""};function c(){4==a.orderList.length?a.order.subTotal=Math.round(3*a.productPrice*a.order.multiplier):a.order.subTotal=Math.round(a.productPrice*a.orderList.length*a.order.multiplier),a.order.discounts=Math.round(a.order.subTotal*a.order.discountRate),a.order.total=Math.round(a.order.subTotal-a.order.discounts),console.log("summing order",a.order)}a.orderList.push(Object.create(d)),c(),a.addAProduct=function(){var e=a.orderList.length;e<4&&a.orderList.push(Object.create(d)),3==e&&(a.state.addAProductBtn.visible=!1),0<e&&(a.state.removeLastProductBtn.visible=!0);for(var t=0;t<=e;t++)a.orderList[t].id=t+1;c()},a.removeLastProduct=function(){var e=a.orderList.length,t=e-1;1<e&&a.orderList.splice(t,1),2==e&&(a.state.removeLastProductBtn.visible=!1),a.state.addAProductBtn.visible=!0,4==e&&(a.order.discounts=0),c()},a.removeAProduct=function(e){var t=e-1;1<a.orderList.length&&a.orderList.splice(t,1);for(var r=0;r<=a.orderList.length-1;r++)a.orderList[r].id=r+1;c()},a.validateProducts=function(){},a.countMixFlavors=function(t){var r=0;return Object.keys(t).forEach(function(e){t[e].selected&&r++}),r},a.updateShoppingCart=function(){a.orderList.forEach(function(t){a.flavors.forEach(function(e){e.name==t.flavor&&(t.sqrId=e.id,t.id<4?t.sqVarId=e.variations[0].id:t.sqVarId=e.variations[1].id)})})},a.buildFlavorList=function(t){a.orderList[t].mixFlvrsSelected=[],Object.keys(a.orderList[t].mixflvrs).forEach(function(e){a.orderList[t].mixflvrs[e].selected&&a.orderList[t].mixFlvrsSelected.push(a.orderList[t].mixflvrs[e].name)})},a.checkPromoCode=function(t){console.log("checking promo code"),i.checkPromoCode(t).then(function(e){e?(a.state.promoCode.input["was-validated"]=!0,a.state.promoCode.input["needs-validation"]=!1,a.state.promoCode.input["is-valid"]=!0,a.state.promoCode.input["is-invalid"]=!1,a.userData.promoCode=t,a.userData.tender.promoActive=!0,a.userData.tender.multiplier=3,a.userData.tender.discountRate=.3):(a.state.promoCode.input["was-validated"]=!0,a.state.promoCode.input["needs-validation"]=!1,a.state.promoCode.input["is-valid"]=!1,a.state.promoCode.input["is-invalid"]=!0,a.userData.promoCode="",a.userData.tender.promoActive=!1,a.userData.tender.multiplier=1,a.userData.tender.discountRate=0,a.userData.tender.subTotal=0),c(),r.$apply()}).catch(function(e){console.log("Error",e)})}}return r.$inject=["$scope","$log","userDataService","stateService","squareService","serverService"],e}angular.module("ansub").directive("productSelection",productSelection);
function shipDest(){t.$inject=["scope","el","attr","ctrl"];var e={restrict:"AECM",template:"<div>testing</div>",replace:!0,scope:{},link:t,controller:i,controllerAs:"vm",bindToController:!0};function t(e,t,i,n){}function i(e,t,i){this.zipCheck=i}return i.$inject=["$scope","$log","zipcomplete"],e}angular.module("ansub").directive("shipDest",shipDest);
function singleAddressInput(){e.$inject=["scope","el","attr","ctrl"];var s={restrict:"AECM",templateUrl:"views/singleAddressInput.htm",replace:!0,scope:{address:"="},link:e,controller:t,controllerAs:"vm",bindToController:!0};function e(s,e,t,i){}function t(s,e,t,i,n){var a=this;a.userData=t,a.state=i,console.log("in singleAddressInputController",n),a.validate=function(s,e){var t=n.physicalAddresses[s](e);a.state.singleAddressInput[s].input["is-invalid"]=t?!(a.state.singleAddressInput[s].input["is-valid"]=!0):!(a.state.singleAddressInput[s].input["is-valid"]=!1)},a.updateBillingAddress=function(){a.state.shipingSameAsBilling&&(a.userData.billingAddress.street=a.userData.shippingDestination.street,a.userData.billingAddress.zip=a.userData.shippingDestination.zip,a.userData.billingAddress.city=a.userData.shippingDestination.city,a.userData.billingAddress.state=a.userData.shippingDestination.state)}}return t.$inject=["$scope","$log","userDataService","stateService","validationService"],s}angular.module("ansub").directive("singleAddressInput",singleAddressInput);
function subTermsCond(){t.$inject=["scope","el","attr","ctrl"];var e={restrict:"AECM",templateUrl:"views/subTermsCond.htm",replace:!0,scope:{},link:t,controller:o,controllerAs:"vm",bindToController:!0};function t(e,t,o,r){}function o(e,t,o,r,s,n,i,c){var a=this;a.state=r,a.userData=s,a.validate=n,a.square=c,console.log("got this state",a.state),a.submitForm=function(){a.square.submitForm().then(function(e){console.log("everything submitted properly")}).cach(function(e){console.log("there was an error with the submission",e)})}}return o.$inject=["$scope","$log","$location","stateService","userDataService","validationService","submissionService","squareService"],e}angular.module("ansub").directive("subTermsCond",subTermsCond);
function errorHandlingService(e,c){return{card:{processingErrors:function(r){console.log("Encountered errors:",r),c.ccProcessing.errors.list=r,c.ccProcessing.errors.thereWereErrors=!0,c.ccProcessing.success.cardDataGood=!1,console.log("stateService.ccProcessing",c.ccProcessing),e.$apply()}},clearErrors:function(){c.ccProcessing={errors:{thereWereErrors:!1,cardNoNotValid:!1,cardCVVNotValid:!1,cardDateNotValid:!1,cardZipNotValid:!1,list:[]},success:{cardDataGood:!1}}}}}ahNuts.service("errorHandlingService",errorHandlingService),errorHandlingService.$inject=["$rootScope","stateService"];
function modalService(o){var n={backdrop:!0,keyboard:!0,modalFade:!0,templateUrl:"partials/modal.htm"},l={closeButtonText:"Close",actionButtonText:"OK",headerText:"Proceed?",bodyText:"Perform this action?"};this.showModal=function(o,e){return o||(o={}),o.backdrop="static",this.show(o,e)},this.show=function(o,e){var t={},a={};return angular.extend(t,n,o),angular.extend(a,l,e),t.controller||(t.controller=function(o,e){o.modalOptions=a,o.modalOptions.ok=function(o){e.close(o)},o.modalOptions.close=function(o){e.dismiss("cancel")}}),$modal.open(t).result}}angular.module("ansub").service("modalService",modalService),modalService.$inject=["$uibModal"];
function serverService(r){return{chargeCard:function(e,t){return new Promise(function(n,o){r({method:"POST",url:e,headers:{"Content-Type":"application/json"},data:t}).then(function(e){console.log("got this response",e),n(e.data)},function(e){o(e)})})},checkPromoCode:function(e){return new Promise(function(n,o){r({method:"GET",url:"/api/check_promoCode?code="+e}).then(function(e){console.log("got this response",e),n(e.data)},function(e){o(e)})})},get:{sqrAppId:function(){return new Promise(function(n,o){r({method:"GET",url:"/api/squareId"}).then(function(e){console.log("got this response",e),n(e.data)},function(e){o(e)})})},sqrPrdctList:function(){return new Promise(function(n,o){r({method:"GET",url:"/api/productList"}).then(function(e){console.log("got this response",e),n(e.data)},function(e){o(e)})})}}}}angular.module("ansub").service("serverService",serverService),serverService.$inject=["$http"];
function squareService(n,c,o,r,t,a){var i=this;function s(e){r.card.nonce=e,o.chargeCard("/api/charge_card",r).then(function(e){var r="/success/"+e.data;console.log("got this path back",r),c.path(r),n.$apply()}).catch(function(e){console.log("Error:",e)})}return{_chargeCardWithNonce:s,submitForm:function(){console.log("submitting form"),t.clearErrors(),i.paymentForm.requestCardNonce()},download:{productList:function(){return new Promise(function(r,n){o.get.sqrPrdctList().then(function(e){r(e)}).catch(function(e){n(e)})})}},init:function(){o.get.sqrAppId().then(function(e){i.paymentForm=new SqPaymentForm({applicationId:e.id,inputClass:"sq-input",inputStyles:[{fontSize:"14px",padding:"7px 12px",backgroundColor:"transparent"}],cardNumber:{elementId:"sq-card-number",placeholder:"•••• •••• •••• ••••"},cvv:{elementId:"sq-cvv",placeholder:"CVV"},expirationDate:{elementId:"sq-expiration-date",placeholder:"MM/YY"},postalCode:{elementId:"sq-postal-code"},callbacks:{cardNonceResponseReceived:function(e,r,n){e?t.card.processingErrors(e):(i.card_errors=[],a.ccProcessing.success.cardDataGood=!0,a.ccProcessing.errors.thereWereErrors=!1,s(r))},unsupportedBrowserDetected:function(){},inputEventReceived:function(e){e.eventType},paymentFormLoaded:function(){}}}),i.paymentForm.build()}).catch(function(e){console.log(e)})}}}angular.module("ansub").service("squareService",squareService),squareService.$inject=["$rootScope","$location","serverService","userDataService","errorHandlingService","stateService"];
function stateService(i){return{shipingSameAsBilling:!0,productSelection:{addAProductBtn:{classes:{btn:!0,"btn-success":!0,"btn-warning":!1},visible:!0},removeLastProductBtn:{classes:{btn:!0,"btn-success":!1,"btn-warning":!1,"btn-danger":!0},visible:!1},headerStyle:{color:"rgb(51,51,51)"},promoCode:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}}},contactInfo:{firstname:{classes:{"form-control":!0,"is-valid":!1,"is-invalid":!1},addressed:!1,isValid:!1,isInvalid:!1}},infoBoxes:{flavorDefs:!1,termsConds:!1},sectionsAddressed:{productSelection:!1,singleShippingAddress:!1,contactInfo:!1,termsConds:!1},sectionsCompleted:{productSelection:!0,singleShippingAddress:!0,contactInfo:!0,termsConds:!1},sectionHeaders:{productSelection:{showError:!1,showCompleted:!1},singleShippingAddress:{showError:!1,showCompleted:!1},contactInfo:{showError:!1,showCompleted:!1},termsConds:{showError:!1,showCompleted:!1}},checkCompletness:function(){var s=this,e=!0;Object.keys(s.sectionsCompleted).forEach(function(i){0==s.sectionsCompleted[i]&&(e=!1)}),s.submissionBtn["btn-secondary"]=e?(readyForSubmission=!0,s.submissionBtn["btn-success"]=!0,!1):(readyForSubmission=!1,s.submissionBtn["btn-success"]=!1,!0)},readyForSubmission:!1,submissionBtn:{btn:!0,"btn-block":!0,"btn-success":!1,"btn-secondary":!0},contactInput:{first:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}},last:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}},phone:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}},email:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}}},singleAddressInput:{street:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}},zip:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}},city:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}},state:{field:{"was-validated":!1,"needs-validation":!0},input:{"is-valid":!1,"is-invalid":!1}}},ccProcessing:{errors:{thereWereErrors:!1,cardNoNotValid:!1,cardCVVNotValid:!1,cardDateNotValid:!1,cardZipNotValid:!1,list:[]},success:{cardDataGood:!1}}}}angular.module("ansub").service("stateService",stateService),stateService.$inject=["userDataService"];
function submissionService(e){this.submit=function(i){return new Promise(function(n,s){e({method:"POST",url:"/subscription-application-submission",headers:{"Content-Type":"application/json"},data:i}).then(function(i){console.log("got this response",i),n(i)},function(i){s(i)})})}}angular.module("ansub").service("submissionService",submissionService),submissionService.$inject=["$http"];
function userDataService(){return{name:{first:"",last:""},contact:{email:"",phone:""},shippingDestination:{street:"",city:"",state:"",zip:""},billingAddress:{street:"",city:"",state:"",zip:""},card:{nonce:"",last4:"",type:"",errors:[]},promoCode:"",orderNo:"",orderDate:"",order:[],tender:{promoActive:!1,multiplier:1,discountRate:0,subTotal:0,discounts:0,shipping:0,total:0},agreedToTerms:!1}}angular.module("ansub").service("userDataService",userDataService),userDataService.$inject=[];
function validationService(e,t){function s(e){var t=!1;return 0<e.length&&(t=!0),t}return{physicalAddresses:{street:s,zip:function(e){return/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(e)},city:function(e){return/^[a-zA-Z]+(?:[\s-][a-zA-Z]+)*$/.test(e)},state:function(e){return/^((A[LKZR])|(C[AOT])|(D[EC])|(FL)|(GA)|(HI)|(I[DLNA])|(K[SY])|(LA)|(M[EDAINSOT])|(N[EVHJMYCD])|(O[HKR])|(PA)|(RI)|(S[CD])|(T[NX])|(UT)|(V[TA])|(W[AVIY]))$/.test(e)}},contact:{first:s,last:s,phone:function(e){return/^[2-9]\d{2}-\d{3}-\d{4}$/.test(e)},email:function(e){return/^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$/.test(e)}},termsAndCond:function(){console.log("validating terms and conditions"),e.sectionsAddressed.termsConds=!0,e.sectionsCompleted.termsConds=t.agreedToTerms,e.sectionsCompleted.termsConds?(e.sectionHeaders.termsConds.showError=!1,e.sectionHeaders.termsConds.showCompleted=!0):(e.sectionHeaders.termsConds.showError=!0,e.sectionHeaders.termsConds.showCompleted=!1)}}}angular.module("ansub").service("validationService",validationService),validationService.$inject=["stateService","userDataService"];
function zipcomplete(){this.handleResp=function(e){e.error_msg?console.log(e.error_msg):"city"in e&&(container.find("input[name='city']").val(e.city),container.find("input[name='state']").val(e.state))},this.checkZip=function(e){var n=e.substring(0,5);5==n.length&&/^[0-9]+$/.test(n)&&console.log("checking zip",n)}}angular.module("ansub").service("zipcomplete",zipcomplete),zipcomplete.$inject=[];
function config(o,e){e.hashPrefix(""),o.when("/",{templateUrl:"views/monthlySub.htm",controller:"mainController",controllerAs:"vm"}).when("/success/:confirmationCode",{templateUrl:"views/success.htm",controller:"successController",controllerAs:"vm"}).otherwise({redirectTo:"/"})}config.$inject=["$routeProvider","$locationProvider"],ahNuts.config(config);